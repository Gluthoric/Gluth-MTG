{% extends "base.html" %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="{{ url_for('static', filename='filters.js') }}" defer></script>
{% endblock %}

{% block title %}Gluthoric's Collection{% endblock %}

{% block content %}
<div class="collection-header">
    <h1>Gluthoric's Collection</h1>
    <div class="collection-stats">
        <span>{{ total_cards_collected }} / {{ total_cards }} collected</span>
        <span>Collection value: ${{ total_value }}</span>
        <div class="progress-bar">
            <div class="progress" style="width: {{ percentage_collected }}%;"></div>
        </div>
        <span>{{ percentage_collected }}% collected!</span>
    </div>
</div>

<div class="edition-filters">
    <label for="set-type">Set Types:</label>
    <select name="set_type" id="set-type" class="form-control" onchange="applyFilter()">
        <option value="">All</option>
        <option value="Special Set">Special Set</option>
        <option value="Sealed Set">Sealed Set</option>
        <option value="Commander">Commander</option>
        <option value="token" {% if request.args.get("set_type") == "token" %}selected{% endif %}>Token</option>
        <option value="duel_deck" {% if request.args.get("set_type") == "duel_deck" %}selected{% endif %}>Duel_Deck</option>
        <option value="promo" {% if request.args.get("set_type") == "promo" %}selected{% endif %}>Promo</option>
        <option value="masters" {% if request.args.get("set_type") == "masters" %}selected{% endif %}>Masters</option>
        <option value="expansion" {% if request.args.get("set_type") == "expansion" %}selected{% endif %}>Expansion</option>
        <option value="memorabilia" {% if request.args.get("set_type") == "memorabilia" %}selected{% endif %}>Memorabilia</option>
        <option value="box" {% if request.args.get("set_type") == "box" %}selected{% endif %}>Box</option>
        <option value="commander" {% if request.args.get("set_type") == "commander" %}selected{% endif %}>Commander</option>
        <option value="draft_innovation" {% if request.args.get("set_type") == "draft_innovation" %}selected{% endif %}>Draft_Innovation</option>
        <option value="masterpiece" {% if request.args.get("set_type") == "masterpiece" %}selected{% endif %}>Masterpiece</option>
        <option value="minigame" {% if request.args.get("set_type") == "minigame" %}selected{% endif %}>Minigame</option>
        <option value="core" {% if request.args.get("set_type") == "core" %}selected{% endif %}>Core</option>
        <option value="starter" {% if request.args.get("set_type") == "starter" %}selected{% endif %}>Starter</option>
        <option value="alchemy" {% if request.args.get("set_type") == "alchemy" %}selected{% endif %}>Alchemy</option>
        <option value="from_the_vault" {% if request.args.get("set_type") == "from_the_vault" %}selected{% endif %}>From_The_Vault</option>
        <option value="archenemy" {% if request.args.get("set_type") == "archenemy" %}selected{% endif %}>Archenemy</option>
        <option value="treasure_chest" {% if request.args.get("set_type") == "treasure_chest" %}selected{% endif %}>Treasure_Chest</option>
        <option value="funny" {% if request.args.get("set_type") == "funny" %}selected{% endif %}>Funny</option>
        <option value="premium_deck" {% if request.args.get("set_type") == "premium_deck" %}selected{% endif %}>Premium_Deck</option>
        <option value="vanguard" {% if request.args.get("set_type") == "vanguard" %}selected{% endif %}>Vanguard</option>
        <option value="spellbook" {% if request.args.get("set_type") == "spellbook" %}selected{% endif %}>Spellbook</option>
        <option value="arsenal" {% if request.args.get("set_type") == "arsenal" %}selected{% endif %}>Arsenal</option>
        <option value="planechase" {% if request.args.get("set_type") == "planechase" %}selected{% endif %}>Planechase</option>
    </select>

    <label for="release-date">Sort by Release Date:</label>
    <select name="release_date" id="release-date" class="form-control" onchange="applyFilter()">
        <option value="desc" {{ 'selected' if request.args.get('release_date', 'desc') == 'desc' else '' }}>DESC</option>
        <option value="asc" {{ 'selected' if request.args.get('release_date') == 'asc' else '' }}>ASC</option>
    </select>

</div>

<div class="edition-grid">
    {% for edition in editions %}
        <div class="edition-card">
            <a href="{{ url_for('edition_view', edition_name=edition.name) }}">
                <img src="{{ edition.icon_svg_uri }}" alt="{{ edition.name }}" class="edition-icon">
                <h3>{{ edition.name }}</h3>
                <p>{{ edition.set_type }}</p>
                <p>Released on: {{ edition.released_at }}</p>
                <p>Cards Collected: {{ edition.collected_cards }} / {{ edition.card_count }}</p>
                <p>Value: ${{ edition.total_value }}</p>
                <button class="btn">View Set</button>
            </a>
        </div>
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('editions', page=page-1) }}" class="btn btn-info">Previous</a>
    {% endif %}
    {% if page < total_pages %}
        <a href="{{ url_for('editions', page=page+1) }}" class="btn btn-info">Next</a>
    {% endif %}
</div>

<script>
    function applyFilter() {
        const setType = document.getElementById('set-type').value;
        const releaseDate = document.getElementById('release-date').value;
        const url = new URL(window.location.href);
        url.searchParams.set('set_type', setType);
        url.searchParams.set('release_date', releaseDate);
        window.location.href = url.href;
    }
</script>
{% endblock %}
