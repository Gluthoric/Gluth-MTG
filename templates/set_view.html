{% extends 'base.html' %}
{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
{% endblock %}
{% from 'card_macro.html' import card_macro %}
{% block title %}{{ set_name }}{% endblock %}

{% block content %}
<h1>{{ set_name }}</h1>

{% if set_info.icon_svg_uri %}
  <img src="{{ set_info.icon_svg_uri }}" alt="{{ set_name }} icon" style="width: 100px;">
{% endif %}

<div>
    <form action="{{ url_for('set_view', set_name=set_name) }}" method="get" class="filter-form">
        <div class="form-group">
            <label for="color">Color:</label>
            <select name="color" id="color" class="form-control">
                <option value="">All</option>
                <option value="W" {% if request.args.get('color') == 'W' %}selected{% endif %}>White</option>
                <option value="U" {% if request.args.get('color') == 'U' %}selected{% endif %}>Blue</option>
                <option value="B" {% if request.args.get('color') == 'B' %}selected{% endif %}>Black</option>
                <option value="R" {% if request.args.get('color') == 'R' %}selected{% endif %}>Red</option>
                <option value="G" {% if request.args.get('color') == 'G' %}selected{% endif %}>Green</option>
            </select>
        </div>
        <div class="form-group">
            <label for="rarity">Rarity:</label>
            <select name="rarity" id="rarity" class="form-control">
                <option value="">All</option>
                <option value="Common" {% if request.args.get('rarity') == 'Common' %}selected{% endif %}>Common</option>
                <option value="Uncommon" {% if request.args.get('rarity') == 'Uncommon' %}selected{% endif %}>Uncommon</option>
                <option value="Rare" {% if request.args.get('rarity') == 'Rare' %}selected{% endif %}>Rare</option>
                <option value="Mythic" {% if request.args.get('rarity') == 'Mythic' %}selected{% endif %}>Mythic</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Filter</button>
    </form>
</div>

<div id="cards-container" class="card-grid">
    {% for card in cards %}
        {{ card_macro(card, set_name=set_name, foil_quantity=(card.quantity.owned_foil if 'owned_foil' in card.quantity else 0), 
                      nonfoil_quantity=(card.quantity.owned_nonfoil if 'owned_nonfoil' in card.quantity else 0), 
                      foil_price=(card.prices.usd_foil if 'usd_foil' in card.prices else 'N/A'), 
                      nonfoil_price=(card.prices.usd if 'usd' in card.prices else 'N/A')) }}
    {% endfor %}
</div>

<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('set_view', set_name=set_name, page=page-1, color=request.args.get('color'), rarity=request.args.get('rarity')) }}" class="btn btn-info">Previous</a>
    {% endif %}
    {% if page < total_pages %}
        <a href="{{ url_for('set_view', set_name=set_name, page=page+1, color=request.args.get('color'), rarity=request.args.get('rarity')) }}" class="btn btn-info">Next</a>
    {% endif %}
</div>
{% endblock %}
